{"remainingRequest":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/src/views/CreateOrder.vue?vue&type=style&index=0&id=0893aef3&scoped=true&lang=css&","dependencies":[{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/src/views/CreateOrder.vue","mtime":1624035305436},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZWwtcm93IHsKICBtYXJnaW4tYm90dG9tOiAyZW07Cn0KLmVsLWRpdmlkZXIgewogIG1hcmdpbjogMDsKICBwYWRkaW5nOiAwLjFlbSAwOwogIGJhY2tncm91bmQtY29sb3I6IHRvbWF0bzsKfQoucm93X3RpdGxlIHsKICBtYXJnaW46IDA7CiAgcGFkZGluZzogMDsKICBmb250LXNpemU6IDEuMmVtOwp9Ci50ZXh0X2JveCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZjFmNjsKfQouYWRkcmVzcyB7CiAgcGFkZGluZzogMWVtOwogIHBhZGRpbmctbGVmdDogMWVtOwogIHdpZHRoOiA3MCU7Cn0KLnNldHRsZSB7CiAgbWFyZ2luOiAwIDA7CiAgcGFkZGluZzogMC4yZW0gMWVtOwogIHRleHQtYWxpZ246IHJpZ2h0Owp9Ci5zdWJtaXRfYnV0dG9uIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjM2LCA2MiwgNjIpOwogIG1hcmdpbi10b3A6IDFlbTsKICBoZWlnaHQ6IDNlbTsKICBsaW5lLWhlaWdodDogM2VtOwogIHRleHQtYWxpZ246IGNlbnRlcjsKfQouY3JlYXRlX3N1Y2Nlc3MgewogIG1hcmdpbjogMCAwOwogIHBhZGRpbmc6IDAuMmVtIDFlbTsKICB0ZXh0LWFsaWduOiBsZWZ0Owp9Cg=="},{"version":3,"sources":["CreateOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CreateOrder.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <Container>\n    <el-row>\n      <el-col :span=\"3\">\n        <pre style=\"margin:0; padding: 0;\">&nbsp;</pre>\n      </el-col>\n      <el-col :span=\"18\">\n        <!-- 收货地址 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>收货地址</span>\n          </p>\n          <el-divider></el-divider>\n          <div class=\"text_box\">\n            <div class=\"address\">\n              <el-radio-group v-model=\"address_id\">\n                <el-radio\n                  v-for=\"address in addresses\"\n                  :key=\"address.id\"\n                  :label=\"address.id\"\n                  style=\"margin-top:0.5em;\"\n                >\n                  {{ address.province }}&nbsp;{{address.city}}&nbsp;{{address.district}}&nbsp;{{address.place}}\n                  &nbsp;（{{address.receiver}}&nbsp;收）{{address.mobile}}\n                </el-radio>\n              </el-radio-group>\n            </div>\n          </div>\n        </el-row>\n        <!-- 支付方式 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>支付方式</span>\n          </p>\n          <el-divider></el-divider>\n          <div class=\"text_box\">\n            <div class=\"address\">\n              <el-radio-group v-model=\"pay_method\">\n                <el-radio :label=\"1\" style=\"margin:0 0.5em;\">货到付款</el-radio>\n                <el-radio :label=\"2\" style=\"margin:0 0.5em;\">支付宝</el-radio>\n                <el-radio :label=\"3\" style=\"margin:0 0.5em;\">微信</el-radio>\n              </el-radio-group>\n            </div>\n          </div>\n        </el-row>\n        <!-- 商品列表 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>商品列表</span>\n          </p>\n          <el-divider></el-divider>\n          <div>\n            <div>\n              <el-table\n                :data=\"skus\"\n                size=\"mini\"\n                height=\"32em\"\n                :header-cell-style=\"{background:'#eef1f6',color:'#606266', 'text-align': 'center'}\"\n                :header-row-style=\"{height:'3em'}\"\n              >\n                <el-table-column type=\"index\" width=\"40\" align=\"center\"></el-table-column>\n                <el-table-column width=\"150\" align=\"center\">\n                  <template slot-scope=\"scope\">\n                    <el-image :src=\"scope.row.default_image_url\" style=\"width: 8em; height: 8em;\"></el-image>\n                  </template>\n                </el-table-column>\n                <el-table-column prop=\"name\" label=\"商品名称\" width=\"300\"></el-table-column>\n                <el-table-column prop=\"spec\" label=\"规格\" width=\"200\" align=\"center\"></el-table-column>\n                <el-table-column prop=\"price\" label=\"价格\" width=\"120\" align=\"center\"></el-table-column>\n                <el-table-column label=\"数量\" width=\"90\" align=\"center\">\n                  <template slot-scope=\"scope\">{{ scope.row.count }}</template>\n                </el-table-column>\n                <el-table-column label=\"小计\" width=\"150\" align=\"center\">\n                  <template\n                    slot-scope=\"scope\"\n                  >{{ (scope.row.count * scope.row.price).toFixed(2) }} &nbsp;元</template>\n                </el-table-column>\n              </el-table>\n            </div>\n          </div>\n        </el-row>\n        <!-- 提交订单 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>提交订单</span>\n          </p>\n          <el-divider></el-divider>\n          <div class=\"text_box\">\n            <p class=\"settle\">\n              <span style=\"font-size: 0.5em;\">共：</span>\n              <span style=\"font-size: 1em; color: red;\">&nbsp;{{ settle.count }}&nbsp;</span>\n              <span style=\"font-size: 0.5em;\">件商品，&nbsp;</span>\n              <span style=\"font-size: 0.5em;\">总金额：</span>\n              <span style=\"font-size: 1em; color: red;\">{{ settle.goods_price.toFixed(2) }}&nbsp;元</span>\n            </p>\n            <p class=\"settle\">\n              <span style=\"font-size: 0.5em;\">运费：</span>\n              <span style=\"font-size: 1em; color: red;\">&nbsp;{{ settle.freight.toFixed(2) }}&nbsp;元</span>\n            </p>\n            <p class=\"settle\">\n              <span style=\"font-size: 0.5em;\">实付款：</span>\n              <span\n                style=\"font-size: 1em; color: red;\"\n              >&nbsp;{{ settle.total_amount.toFixed(2) }}&nbsp;元</span>\n            </p>\n          </div>\n          <div>\n            <el-col :span=\"20\">\n              <pre style=\"margin:0; padding: 0;\">&nbsp;</pre>\n            </el-col>\n            <el-col :span=\"4\">\n              <div class=\"submit_button\">\n                <el-link\n                  style=\"color: white; font-size: 1.2em;\"\n                  :underline=\"false\"\n                  @click=\"submit_order\"\n                >提&nbsp;交&nbsp;订&nbsp;单</el-link>\n              </div>\n            </el-col>\n          </div>\n        </el-row>\n        <!-- 创建订单成功后的弹框 -->\n        <el-dialog :visible.sync=\"dialogVisible\" width=\"40em\" :before-close=\"handleClose\">\n          <el-row>\n            <el-col :span=\"6\">\n              <el-image :src=\"success\" style=\"width: 10em;\"></el-image>\n            </el-col>\n            <el-col :span=\"18\" style=\"text-align: center;\">\n              <p class=\"create_success\">\n                <span>恭喜！订单创建成功，订单号：</span>\n                <span style=\"color: red;\">{{ order_id }}</span>\n              </p>\n              <p class=\"create_success\">\n                <span>感谢您在张老师的平台购物，祝您购物愉快！</span>\n              </p>\n              <p class=\"create_success\">\n                <span>如有任何问题，请联系张老师当面解决。其他任何途径一概不理，就这么银杏！</span>\n              </p>\n            </el-col>\n          </el-row>\n          <span slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"$router.replace({name: 'home'})\">继 续 购 物</el-button>\n            <el-button v-if=\"pay_method != 1\" type=\"danger\" @click=\"pay_order\">立 即 支 付</el-button>\n          </span>\n        </el-dialog>\n      </el-col>\n    </el-row>\n  </Container>\n</template>\n<script>\nimport Container from \"@/components/Container.vue\";\n\nexport default {\n  name: \"CreateOrder\",\n  data() {\n    return {\n      // 需要生成订单的sku数组\n      skus: [],\n\n      // 收货地址、当前选中的收货地址\n      addresses: [],\n      address_id: 0,\n\n      // 支付方式\n      pay_method: 2,\n\n      // 创建成功的订单号\n      order_id: 0,\n\n      // 创建订单后的弹窗展示变量\n      dialogVisible: false,\n\n      // 本地图片\n      success: require(\"../assets/images/success.jpeg\")\n    };\n  },\n  mounted() {\n    this.get_addrsss();\n    this.order_list();\n  },\n  methods: {\n    // 获取收货地址\n    get_addrsss() {\n      this.$api.address().then(res => {\n        this.addresses = res.data.address;\n        this.address_id = this.addresses[0].id;\n      });\n    },\n    // 待结算商品列表\n    order_list() {\n      this.$api.order_settlement_list().then(res => {\n        this.skus = res.data;\n      });\n    },\n\n    // 提交订单\n    submit_order() {\n      // 准备数据\n      let data = {\n        address: this.address_id,\n        pay_method: this.pay_method,\n        total_count: this.settle.count,\n        total_amount: this.settle.total_amount,\n        freight: this.settle.freight\n      };\n      this.$api.submit_order(data).then(res => {\n        if (res.status == 201) {\n          this.order_id = res.data.order_id;\n          this.dialogVisible = true;\n        }\n      });\n    },\n\n    // 立即支付\n    pay_order() {\n      if (this.pay_method == 2) {\n        this.$api.payment_url(this.order_id).then(res => {\n          window.open(res.data.url);\n          // location.href = res.data.url;\n          this.$router.push({ name: \"orders\", params: { id: this.order_id } });\n        });\n      }\n      if (this.pay_method == 3) {\n        this.$message({\n          message: \"暂不支持微信支付！\",\n          type: \"warning\"\n        });\n      }\n    },\n\n    // 离开支付的确认弹窗\n    handleClose() {\n      if (this.pay_method != 1) {\n        this.$confirm(\"当前订单还未支付，确认离开？\").then(() => {\n          this.$router.replace({ name: \"cart\" });\n        });\n      }\n    }\n  },\n  computed: {\n    // 计算商品数量、运费、总金额等\n    settle() {\n      let count = 0;\n      let goods_price = 0;\n      this.skus.forEach(sku => {\n        count += sku.count;\n        goods_price += sku.count * sku.price;\n      });\n      let freight = (10 * count) / 2;\n      return {\n        count: count,\n        goods_price: goods_price,\n        freight: freight,\n        total_amount: freight + goods_price\n      };\n    }\n  },\n  components: {\n    Container\n  }\n};\n</script>\n<style  scoped>\n.el-row {\n  margin-bottom: 2em;\n}\n.el-divider {\n  margin: 0;\n  padding: 0.1em 0;\n  background-color: tomato;\n}\n.row_title {\n  margin: 0;\n  padding: 0;\n  font-size: 1.2em;\n}\n.text_box {\n  background-color: #eef1f6;\n}\n.address {\n  padding: 1em;\n  padding-left: 1em;\n  width: 70%;\n}\n.settle {\n  margin: 0 0;\n  padding: 0.2em 1em;\n  text-align: right;\n}\n.submit_button {\n  background-color: rgb(236, 62, 62);\n  margin-top: 1em;\n  height: 3em;\n  line-height: 3em;\n  text-align: center;\n}\n.create_success {\n  margin: 0 0;\n  padding: 0.2em 1em;\n  text-align: left;\n}\n</style>"]}]}