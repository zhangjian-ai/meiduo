{"remainingRequest":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/src/views/CreateOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/src/views/CreateOrder.vue","mtime":1624035305436},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangjian/PycharmProjects/meiduo/meiduo_mall_frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBDb250YWluZXIgZnJvbSAiQC9jb21wb25lbnRzL0NvbnRhaW5lci52dWUiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJDcmVhdGVPcmRlciIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIC8vIOmcgOimgeeUn+aIkOiuouWNleeahHNrdeaVsOe7hAogICAgICBza3VzOiBbXSwKCiAgICAgIC8vIOaUtui0p+WcsOWdgOOAgeW9k+WJjemAieS4reeahOaUtui0p+WcsOWdgAogICAgICBhZGRyZXNzZXM6IFtdLAogICAgICBhZGRyZXNzX2lkOiAwLAoKICAgICAgLy8g5pSv5LuY5pa55byPCiAgICAgIHBheV9tZXRob2Q6IDIsCgogICAgICAvLyDliJvlu7rmiJDlip/nmoTorqLljZXlj7cKICAgICAgb3JkZXJfaWQ6IDAsCgogICAgICAvLyDliJvlu7rorqLljZXlkI7nmoTlvLnnqpflsZXnpLrlj5jph48KICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCgogICAgICAvLyDmnKzlnLDlm77niYcKICAgICAgc3VjY2VzczogcmVxdWlyZSgiLi4vYXNzZXRzL2ltYWdlcy9zdWNjZXNzLmpwZWciKQogICAgfTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmdldF9hZGRyc3NzKCk7CiAgICB0aGlzLm9yZGVyX2xpc3QoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOiOt+WPluaUtui0p+WcsOWdgAogICAgZ2V0X2FkZHJzc3MoKSB7CiAgICAgIHRoaXMuJGFwaS5hZGRyZXNzKCkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMuYWRkcmVzc2VzID0gcmVzLmRhdGEuYWRkcmVzczsKICAgICAgICB0aGlzLmFkZHJlc3NfaWQgPSB0aGlzLmFkZHJlc3Nlc1swXS5pZDsKICAgICAgfSk7CiAgICB9LAogICAgLy8g5b6F57uT566X5ZWG5ZOB5YiX6KGoCiAgICBvcmRlcl9saXN0KCkgewogICAgICB0aGlzLiRhcGkub3JkZXJfc2V0dGxlbWVudF9saXN0KCkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMuc2t1cyA9IHJlcy5kYXRhOwogICAgICB9KTsKICAgIH0sCgogICAgLy8g5o+Q5Lqk6K6i5Y2VCiAgICBzdWJtaXRfb3JkZXIoKSB7CiAgICAgIC8vIOWHhuWkh+aVsOaNrgogICAgICBsZXQgZGF0YSA9IHsKICAgICAgICBhZGRyZXNzOiB0aGlzLmFkZHJlc3NfaWQsCiAgICAgICAgcGF5X21ldGhvZDogdGhpcy5wYXlfbWV0aG9kLAogICAgICAgIHRvdGFsX2NvdW50OiB0aGlzLnNldHRsZS5jb3VudCwKICAgICAgICB0b3RhbF9hbW91bnQ6IHRoaXMuc2V0dGxlLnRvdGFsX2Ftb3VudCwKICAgICAgICBmcmVpZ2h0OiB0aGlzLnNldHRsZS5mcmVpZ2h0CiAgICAgIH07CiAgICAgIHRoaXMuJGFwaS5zdWJtaXRfb3JkZXIoZGF0YSkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwMSkgewogICAgICAgICAgdGhpcy5vcmRlcl9pZCA9IHJlcy5kYXRhLm9yZGVyX2lkOwogICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyDnq4vljbPmlK/ku5gKICAgIHBheV9vcmRlcigpIHsKICAgICAgaWYgKHRoaXMucGF5X21ldGhvZCA9PSAyKSB7CiAgICAgICAgdGhpcy4kYXBpLnBheW1lbnRfdXJsKHRoaXMub3JkZXJfaWQpLnRoZW4ocmVzID0+IHsKICAgICAgICAgIHdpbmRvdy5vcGVuKHJlcy5kYXRhLnVybCk7CiAgICAgICAgICAvLyBsb2NhdGlvbi5ocmVmID0gcmVzLmRhdGEudXJsOwogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAib3JkZXJzIiwgcGFyYW1zOiB7IGlkOiB0aGlzLm9yZGVyX2lkIH0gfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGF5X21ldGhvZCA9PSAzKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICBtZXNzYWdlOiAi5pqC5LiN5pSv5oyB5b6u5L+h5pSv5LuY77yBIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIgogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8vIOemu+W8gOaUr+S7mOeahOehruiupOW8ueeqlwogICAgaGFuZGxlQ2xvc2UoKSB7CiAgICAgIGlmICh0aGlzLnBheV9tZXRob2QgIT0gMSkgewogICAgICAgIHRoaXMuJGNvbmZpcm0oIuW9k+WJjeiuouWNlei/mOacquaUr+S7mO+8jOehruiupOemu+W8gO+8nyIpLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoeyBuYW1lOiAiY2FydCIgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICAvLyDorqHnrpfllYblk4HmlbDph4/jgIHov5DotLnjgIHmgLvph5Hpop3nrYkKICAgIHNldHRsZSgpIHsKICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgbGV0IGdvb2RzX3ByaWNlID0gMDsKICAgICAgdGhpcy5za3VzLmZvckVhY2goc2t1ID0+IHsKICAgICAgICBjb3VudCArPSBza3UuY291bnQ7CiAgICAgICAgZ29vZHNfcHJpY2UgKz0gc2t1LmNvdW50ICogc2t1LnByaWNlOwogICAgICB9KTsKICAgICAgbGV0IGZyZWlnaHQgPSAoMTAgKiBjb3VudCkgLyAyOwogICAgICByZXR1cm4gewogICAgICAgIGNvdW50OiBjb3VudCwKICAgICAgICBnb29kc19wcmljZTogZ29vZHNfcHJpY2UsCiAgICAgICAgZnJlaWdodDogZnJlaWdodCwKICAgICAgICB0b3RhbF9hbW91bnQ6IGZyZWlnaHQgKyBnb29kc19wcmljZQogICAgICB9OwogICAgfQogIH0sCiAgY29tcG9uZW50czogewogICAgQ29udGFpbmVyCiAgfQp9Owo="},{"version":3,"sources":["CreateOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsJA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CreateOrder.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <Container>\n    <el-row>\n      <el-col :span=\"3\">\n        <pre style=\"margin:0; padding: 0;\">&nbsp;</pre>\n      </el-col>\n      <el-col :span=\"18\">\n        <!-- 收货地址 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>收货地址</span>\n          </p>\n          <el-divider></el-divider>\n          <div class=\"text_box\">\n            <div class=\"address\">\n              <el-radio-group v-model=\"address_id\">\n                <el-radio\n                  v-for=\"address in addresses\"\n                  :key=\"address.id\"\n                  :label=\"address.id\"\n                  style=\"margin-top:0.5em;\"\n                >\n                  {{ address.province }}&nbsp;{{address.city}}&nbsp;{{address.district}}&nbsp;{{address.place}}\n                  &nbsp;（{{address.receiver}}&nbsp;收）{{address.mobile}}\n                </el-radio>\n              </el-radio-group>\n            </div>\n          </div>\n        </el-row>\n        <!-- 支付方式 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>支付方式</span>\n          </p>\n          <el-divider></el-divider>\n          <div class=\"text_box\">\n            <div class=\"address\">\n              <el-radio-group v-model=\"pay_method\">\n                <el-radio :label=\"1\" style=\"margin:0 0.5em;\">货到付款</el-radio>\n                <el-radio :label=\"2\" style=\"margin:0 0.5em;\">支付宝</el-radio>\n                <el-radio :label=\"3\" style=\"margin:0 0.5em;\">微信</el-radio>\n              </el-radio-group>\n            </div>\n          </div>\n        </el-row>\n        <!-- 商品列表 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>商品列表</span>\n          </p>\n          <el-divider></el-divider>\n          <div>\n            <div>\n              <el-table\n                :data=\"skus\"\n                size=\"mini\"\n                height=\"32em\"\n                :header-cell-style=\"{background:'#eef1f6',color:'#606266', 'text-align': 'center'}\"\n                :header-row-style=\"{height:'3em'}\"\n              >\n                <el-table-column type=\"index\" width=\"40\" align=\"center\"></el-table-column>\n                <el-table-column width=\"150\" align=\"center\">\n                  <template slot-scope=\"scope\">\n                    <el-image :src=\"scope.row.default_image_url\" style=\"width: 8em; height: 8em;\"></el-image>\n                  </template>\n                </el-table-column>\n                <el-table-column prop=\"name\" label=\"商品名称\" width=\"300\"></el-table-column>\n                <el-table-column prop=\"spec\" label=\"规格\" width=\"200\" align=\"center\"></el-table-column>\n                <el-table-column prop=\"price\" label=\"价格\" width=\"120\" align=\"center\"></el-table-column>\n                <el-table-column label=\"数量\" width=\"90\" align=\"center\">\n                  <template slot-scope=\"scope\">{{ scope.row.count }}</template>\n                </el-table-column>\n                <el-table-column label=\"小计\" width=\"150\" align=\"center\">\n                  <template\n                    slot-scope=\"scope\"\n                  >{{ (scope.row.count * scope.row.price).toFixed(2) }} &nbsp;元</template>\n                </el-table-column>\n              </el-table>\n            </div>\n          </div>\n        </el-row>\n        <!-- 提交订单 -->\n        <el-row>\n          <p class=\"row_title\">\n            <span>提交订单</span>\n          </p>\n          <el-divider></el-divider>\n          <div class=\"text_box\">\n            <p class=\"settle\">\n              <span style=\"font-size: 0.5em;\">共：</span>\n              <span style=\"font-size: 1em; color: red;\">&nbsp;{{ settle.count }}&nbsp;</span>\n              <span style=\"font-size: 0.5em;\">件商品，&nbsp;</span>\n              <span style=\"font-size: 0.5em;\">总金额：</span>\n              <span style=\"font-size: 1em; color: red;\">{{ settle.goods_price.toFixed(2) }}&nbsp;元</span>\n            </p>\n            <p class=\"settle\">\n              <span style=\"font-size: 0.5em;\">运费：</span>\n              <span style=\"font-size: 1em; color: red;\">&nbsp;{{ settle.freight.toFixed(2) }}&nbsp;元</span>\n            </p>\n            <p class=\"settle\">\n              <span style=\"font-size: 0.5em;\">实付款：</span>\n              <span\n                style=\"font-size: 1em; color: red;\"\n              >&nbsp;{{ settle.total_amount.toFixed(2) }}&nbsp;元</span>\n            </p>\n          </div>\n          <div>\n            <el-col :span=\"20\">\n              <pre style=\"margin:0; padding: 0;\">&nbsp;</pre>\n            </el-col>\n            <el-col :span=\"4\">\n              <div class=\"submit_button\">\n                <el-link\n                  style=\"color: white; font-size: 1.2em;\"\n                  :underline=\"false\"\n                  @click=\"submit_order\"\n                >提&nbsp;交&nbsp;订&nbsp;单</el-link>\n              </div>\n            </el-col>\n          </div>\n        </el-row>\n        <!-- 创建订单成功后的弹框 -->\n        <el-dialog :visible.sync=\"dialogVisible\" width=\"40em\" :before-close=\"handleClose\">\n          <el-row>\n            <el-col :span=\"6\">\n              <el-image :src=\"success\" style=\"width: 10em;\"></el-image>\n            </el-col>\n            <el-col :span=\"18\" style=\"text-align: center;\">\n              <p class=\"create_success\">\n                <span>恭喜！订单创建成功，订单号：</span>\n                <span style=\"color: red;\">{{ order_id }}</span>\n              </p>\n              <p class=\"create_success\">\n                <span>感谢您在张老师的平台购物，祝您购物愉快！</span>\n              </p>\n              <p class=\"create_success\">\n                <span>如有任何问题，请联系张老师当面解决。其他任何途径一概不理，就这么银杏！</span>\n              </p>\n            </el-col>\n          </el-row>\n          <span slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"$router.replace({name: 'home'})\">继 续 购 物</el-button>\n            <el-button v-if=\"pay_method != 1\" type=\"danger\" @click=\"pay_order\">立 即 支 付</el-button>\n          </span>\n        </el-dialog>\n      </el-col>\n    </el-row>\n  </Container>\n</template>\n<script>\nimport Container from \"@/components/Container.vue\";\n\nexport default {\n  name: \"CreateOrder\",\n  data() {\n    return {\n      // 需要生成订单的sku数组\n      skus: [],\n\n      // 收货地址、当前选中的收货地址\n      addresses: [],\n      address_id: 0,\n\n      // 支付方式\n      pay_method: 2,\n\n      // 创建成功的订单号\n      order_id: 0,\n\n      // 创建订单后的弹窗展示变量\n      dialogVisible: false,\n\n      // 本地图片\n      success: require(\"../assets/images/success.jpeg\")\n    };\n  },\n  mounted() {\n    this.get_addrsss();\n    this.order_list();\n  },\n  methods: {\n    // 获取收货地址\n    get_addrsss() {\n      this.$api.address().then(res => {\n        this.addresses = res.data.address;\n        this.address_id = this.addresses[0].id;\n      });\n    },\n    // 待结算商品列表\n    order_list() {\n      this.$api.order_settlement_list().then(res => {\n        this.skus = res.data;\n      });\n    },\n\n    // 提交订单\n    submit_order() {\n      // 准备数据\n      let data = {\n        address: this.address_id,\n        pay_method: this.pay_method,\n        total_count: this.settle.count,\n        total_amount: this.settle.total_amount,\n        freight: this.settle.freight\n      };\n      this.$api.submit_order(data).then(res => {\n        if (res.status == 201) {\n          this.order_id = res.data.order_id;\n          this.dialogVisible = true;\n        }\n      });\n    },\n\n    // 立即支付\n    pay_order() {\n      if (this.pay_method == 2) {\n        this.$api.payment_url(this.order_id).then(res => {\n          window.open(res.data.url);\n          // location.href = res.data.url;\n          this.$router.push({ name: \"orders\", params: { id: this.order_id } });\n        });\n      }\n      if (this.pay_method == 3) {\n        this.$message({\n          message: \"暂不支持微信支付！\",\n          type: \"warning\"\n        });\n      }\n    },\n\n    // 离开支付的确认弹窗\n    handleClose() {\n      if (this.pay_method != 1) {\n        this.$confirm(\"当前订单还未支付，确认离开？\").then(() => {\n          this.$router.replace({ name: \"cart\" });\n        });\n      }\n    }\n  },\n  computed: {\n    // 计算商品数量、运费、总金额等\n    settle() {\n      let count = 0;\n      let goods_price = 0;\n      this.skus.forEach(sku => {\n        count += sku.count;\n        goods_price += sku.count * sku.price;\n      });\n      let freight = (10 * count) / 2;\n      return {\n        count: count,\n        goods_price: goods_price,\n        freight: freight,\n        total_amount: freight + goods_price\n      };\n    }\n  },\n  components: {\n    Container\n  }\n};\n</script>\n<style  scoped>\n.el-row {\n  margin-bottom: 2em;\n}\n.el-divider {\n  margin: 0;\n  padding: 0.1em 0;\n  background-color: tomato;\n}\n.row_title {\n  margin: 0;\n  padding: 0;\n  font-size: 1.2em;\n}\n.text_box {\n  background-color: #eef1f6;\n}\n.address {\n  padding: 1em;\n  padding-left: 1em;\n  width: 70%;\n}\n.settle {\n  margin: 0 0;\n  padding: 0.2em 1em;\n  text-align: right;\n}\n.submit_button {\n  background-color: rgb(236, 62, 62);\n  margin-top: 1em;\n  height: 3em;\n  line-height: 3em;\n  text-align: center;\n}\n.create_success {\n  margin: 0 0;\n  padding: 0.2em 1em;\n  text-align: left;\n}\n</style>"]}]}